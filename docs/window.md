# 窗口

这里主要讲述TUI（Text User Interface）模式下，GDB的多窗口布局。



## TUI窗口

目前支持如下窗口：

1. 命令行，我们启动gdb后默认看到的窗口
2. 源码，显示当前调试位置处对应的源码
3. 汇编，显示源码对应的汇编代码，默认是AT&T汇编
4. 寄存器，显示寄存器列表和其对应的值

其中，命令窗口总是存在，而其他窗口可以相互受限的组合如下：

1. 源码
2. 汇编
3. 源码和汇编
4. 源码和寄存器
5. 汇编和寄存器

日常调试中推荐使用『命令窗口+源码窗口』的方式。该方式可以直接通过命令`gdb -tui demo`开启，但不够灵活。下文主要介绍通过TUI快捷键来开启TUI的多窗口模式。

### TUI快捷键

#### 基础知识

gdb的快捷键使用了Emacs快捷键的子集，这里简要介绍下gdb或者说Emacs快捷键的基本使用。

下文以`C`代表`CTRL`键，此处仅介绍如下三种快捷键使用：

1. `C-<chr>`表示同时按下`CTRL`和`<chr>`键。

2. `C-<chr1> <chr2> `表示同时按下`CTRL`和`<chr1>`键，再释放，最后按下`<chr2>`键。

3. `C-<chr1> C-<chr2>`为两个连续的组合键。即先同时按住`CTRL`和`<chr1>`，再释放，接着同时按下`CTRL`和`<chr2>`键。

上述三种方式已经足够我们在gdb中使用了，想深入了解更多快捷键用法的读者可以参考： https://www.gnu.org/software/emacs/tour/

### 常用快捷键

gdb在TUI模式最主要的几个快捷键：

* `C-x a` 从命令行窗口切换到TUI模式，或者从TUI模式切换回命令行
* `C-x 1`从命令行切换到『命令行+源码』的TUI模式
* `C-x 2`从命令行切换到『命令行+源码+汇编』的TUI模式
* `C-x o`从不同的窗口之间切换焦点
* `C-x s`从命令行切换到**SingleKey**的TUI模式。就是只接受几个常用的gdb调试命令

### 布局示例

使用命令`gdb demo`启动gdb后。

`C-x 1`效果如下：

![image-20200717173430320](https://raw.githubusercontent.com/Zacharier/gdb-debug/master/assets/img/image-20200717173430320.png)

*注：这也是通过命令`gdb -tui demo`启动时的默认显示窗口。*

窗口被一分为二，上面的窗口为源码窗口，下面的窗口为命令行窗口。

`C-x 2`效果如下：

![image-20200717173710011](https://raw.githubusercontent.com/Zacharier/gdb-debug/master/assets/img/image-20200717173710011.png)

窗口被一分为三，由上到下依次是：源码窗口、汇编窗口和命令行窗口。

重复按`C-x 2`可以看到更多的窗口组合，如：

![image-20200717174123695](https://raw.githubusercontent.com/Zacharier/gdb-debug/master/assets/img/image-20200717174123695.png)

由上到下分别变成：寄存器窗口、源码窗口和命令行窗口。

**提示：可以通过`C-x o`切换窗口焦点。另外，TUI模式因为是文本界面，经常在切换时文本界面显示异常的BUG，此时使用`C-l `清屏即可恢复正常。**

最后，通过`C-x a`退出TUI模式，回到命令行模式。

## Emacs窗口

这里简单介绍下Emacs下gdb调试。

使用Emacs编辑源码时，执行`M-x gdb`可以打开gdb命令行窗口，支持在Emacs中进行gdb调试，调试方式和gdb中命令行模式一样。另外，Emacs支持一种更为强大的多窗口调试，通过执行`M-x gdb-many-windows`可以看到如下效果：

![image-20200718011223849](https://raw.githubusercontent.com/Zacharier/gdb-debug/master/assets/img/image-20200718011223849.png)

上图的布局解释如下：

```
     +--------------------------------+--------------------------------+
     |   命令行                        |   本地变量/寄存器                |
     |--------------------------------+--------------------------------+
     |   源码                          |   输入/输出                     |
     |--------------------------------+--------------------------------+
     |   堆栈                          |   断点/线程                     |
     +--------------------------------+--------------------------------+
```

更多Emacs+gdb调试程序的信息可以参考：https://www.gnu.org/software/emacs/manual/html_node/emacs/GDB-Graphical-Interface.html



## 一些问题

对于执行`l`命令提示找不到源码的情况，需手动通过`dir`命令指定源码路径，且二进制可执行文件也要确保使用`-g`参数进行编译。

